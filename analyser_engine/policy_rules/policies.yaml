policy_name: "PLC1_Traffic_Policy"
description: "Full Modbus policy for PLC1 (10.10.10.11) with time constraints, TID monitoring, exception detection, and NIS2 alignment"

modbus_device:
  name: "PLC1_Modbus_Server"
  ip: "10.10.10.11"
  unit_id: 1
  mac_address: "08:00:27:11:22:33"
  geo_location: "Ireland"

allowed_client_operations:
  "10.10.10.10":  # HMI client
    - func: "READ_COILS"
      func_code: 1
      addresses: [0]
      severity: "low"
      active_window:
        start: "07:00"
        end: "20:00"
    - func: "WRITE_SINGLE_REGISTER"
      func_code: 6
      addresses: [0]
      severity: "high"
      active_window:
        start: "08:00"
        end: "18:00"
    - func: "READ_HOLDING_REGISTERS"
      func_code: 3
      addresses: [0, 1, 2]
      severity: "medium"
      active_window:
        start: "07:00"
        end: "20:00"

rate_limits:
  max_requests_per_minute: 50
  max_write_commands_per_minute: 10
  severity: "medium"
  NIS2_article: 23

value_constraints:
  holding_registers:
    0: { min: 0, max: 9, severity: "high", NIS2_article: 21 }
    1: { min: 0, max: 5, severity: "medium", NIS2_article: 21 }
    2: { min: 1, max: 3, severity: "medium", NIS2_article: 21 }

conditional_rules:
  - when:
      register: 1
      value: 3
    prohibit:
      func_codes: [6]  # WRITE_SINGLE_REGISTER
    severity: "critical"
    NIS2_article: 21
    notes: "Prevent filling tank when already full (reg1=3)"

alerts:
  detect_exception_responses:
    enabled: true
    severity: "medium"
    NIS2_article: 26

  detect_broadcast_scans:
    enabled: true
    severity: "high"
    NIS2_article: 23

  detect_invalid_function_codes:
    enabled: true
    severity: "high"
    NIS2_article: 26

  detect_empty_payloads:
    enabled: true
    severity: "medium"
    NIS2_article: 21

  alert_on_unexpected_clients:
    enabled: true
    severity: "high"
    NIS2_article: 21

  alert_on_forbidden_function:
    enabled: true
    severity: "critical"
    NIS2_article: 21

  alert_on_prohibited_condition:
    enabled: true
    severity: "critical"
    NIS2_article: 21

  detect_tid_mismatch:
    enabled: true
    severity: "critical"
    NIS2_article: 23
    notes: "Detects potential MITM attacks by tracking request/response transaction IDs"

